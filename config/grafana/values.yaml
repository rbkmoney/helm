replicas: 1
image:
  repository: grafana/grafana
  tag: 7.2.1
  sha: ""
  pullPolicy: IfNotPresent

extraEmptyDirMounts:
  - name: dashboard-dir
    mountPath: /var/lib/grafana/dashboards/general

envValueFrom:
  ELASTIC_PASS:
    secretKeyRef:
      name: rbkmoney-es-elastic-user
      key: elastic


extraInitContainers: 
  - name: dashboard-autosync
    image: alpine/git:v2.26.2
    imagePullPolicy: IfNotPresent
    args:
    - clone
    - -b
    - dashboard/release
    - git@github.com:rbkmoney/grafana-jsonnet.git
    - /git/dashboards  
    env:
      - name: GIT_SSH_COMMAND
        value: "$(cat /etc/synckey/synckey > /git/synckey && chmod 400 /git/synckey) && ssh -o 'StrictHostKeyChecking no' -i /git/synckey"
    volumeMounts:
      - name: dashboard-dir
        mountPath: "/git/dashboards"
      - name: sync-key
        mountPath: "/etc/synckey"
        readOnly: false
    securityContext:
     runAsUser: 0

extraContainerVolumes: 
  - name: sync-key
    secret:
      secretName: grafana-env
      items:
      - key: synckey
        path: synckey
        mode: 0600

#Use your ssh private key for sync dashboard from repo 
envRenderSecret: 
  synckey: |
    <your ssh privat key>

plugins: []
  # - digrich-bubblechart-panel
  # - grafana-clock-panel

datasources:
  datasources.yaml:
    apiVersion: 1
    datasources:
    - name: rbkm-elasticsearch
      type: elasticsearch
      database: "filebeat-*"
      url: https://rbkmoney-es-http:9200
      basicAuth: true
      basicAuthUser: elastic
      basicAuthPassword: $ELASTIC_PASS
      jsonData:
        timeField: "@timestamp"
        esVersion: 70
        tlsSkipVerify: true

dashboardProviders: 
  dashboardproviders.yaml:
    apiVersion: 1
    providers:
    - name: 'general'
      orgId: 1
      folder: ''
      type: file
      disableDeletion: false
      editable: true
      options:
        path: /var/lib/grafana/dashboards

grafana.ini:
  paths:
    data: /var/lib/grafana/data
    logs: /var/log/grafana
    plugins: /var/lib/grafana/plugins
    provisioning: /etc/grafana/provisioning
  analytics:
    check_for_updates: true
  log:
    mode: console
  grafana_net:
    url: https://grafana.net

sidecar:
  image:
    repository: kiwigrid/k8s-sidecar
    tag: 1.1.0
    sha: ""
  imagePullPolicy: IfNotPresent
  resources: {}
  enableUniqueFilenames: false
  dashboards:
    enabled: false
    SCProvider: true
    label: grafana_dashboard
    folder: /tmp/dashboards
    defaultFolderName: null
    searchNamespace: null
    folderAnnotation: null
    provider:
      name: sidecarProvider
      orgid: 1
      folder: ''
      type: file
      disableDelete: false
      allowUiUpdates: false
      foldersFromFilesStructure: false
  datasources:
    enabled: false
    label: grafana_datasource
    searchNamespace: null
  notifiers:
    enabled: false
    label: grafana_notifier
    searchNamespace: null
revisionHistoryLimit: 10
