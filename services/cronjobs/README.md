# Cronjobs

Helm-chart для кронджоб.

## Конфигурация

Пример минимального описания:

```yaml
jobs:
- name: cronjob-name
  schedule: "0 * * * *"
  backoffLimit: 1
  activeDeadlineSeconds: 60
  command:
  - npm
  - run
  - something
  env:
  - name: ENV_VAR_NAME
    value: "env-var-value"
  resources:
    cpu: 100m
    memory: 256Mi
```

Доступны следующие настройки для конфигурации:

| Параметр | Описание | Значение по умолчанию |
| --- | --- | --- |
| global.image.repository | Полное имя докер-образа приложения | `""` |
| global.image.tag | Репозиторий, в котором находится docker-image | `latest` |
| global.image.pullPolicy | Политика загрузки образов | `IfNotPresent` |
| jobs | Список кронджоб | `[]` |
| app.team | Команда, этот параметр определяет куда собирать логи | |
| app.logs.json | Указатель, в какомо формате пишутся логи | `true` |

В рамках описания конкретной джобы доступны следующие параметры:

| Параметр | Описание | Значение по умолчанию |
| --- | --- | --- |
| name | Имя кронджобы. Полное имя будет сформировано из этого имени и имени релиза, т.е. например, для джобы `update-cards` сервиса `cards-service` имя будет `cards-service-update-cards-job`. Если не указано, то будет взято просто имя релиза. Если указано имя и имя релиза заканчивается на `-job`, то оно будет перенесено в конец, например, если имя релиза `rbk-emailchecker-job` и имя джобы `promo`, финальное имя будет `rbk-emailchecker-promo-job` | |
| image | Секция `image` аналогичная `global.image`, которая оверрайдит его | `{}` |
| schedule | Расписание, с которым джоба будет запускаться. Понять как вам нужно настроить расписание можно, например, с помощью [этого сайтика](https://crontab.guru/) | |
| backoffLimit | Количество ретраев джобы, перед тем как считать ее неуспешной | `3` |
| activeDeadlineSeconds | Период времени, за которое джоба должна отработать. Если не успевает, то должна быть убита | |
| failedJobsHistoryLimit | Количество сфейленных джоб, которые сразу не удаляются | `3` |
| successfulJobsHistoryLimit | Количество успешно выполненных джоб, которые сразу не удаляются | `3` |
| concurrencyPolicy | Политика запуска джоб. Рекомендуется оставлять значение по умолчанию. При нем новая джоба не будет запускаться, пока не завершилась старая | `Forbid` |
| command | Команда для запуска в виде списка. Пример выше | |
| env | Список переменных окружения | |
| resources.cpu | Количество CPU, которое необходимо джобе для выполнения | |
| resources.memory | Количество памяти, которое необходимо джобе для выполнения | |
